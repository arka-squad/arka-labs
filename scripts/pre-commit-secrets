#!/usr/bin/env bash
set -euo pipefail

if ! command -v gitleaks >/dev/null 2>&1; then
  echo "gitleaks manquant → échec (install: https://github.com/gitleaks/gitleaks#install)" >&2
  exit 1
fi

# Scan des changements STAGÉS avant commit (bloquant si fuite)
gitleaks protect --staged --no-banner --redact --exit-code 1

# Optionnel: scan complet si FULL_SCAN=1 (ex: première exécution locale)
if [[ "${FULL_SCAN:-0}" == "1" ]]; then
  gitleaks detect --no-banner --redact --exit-code 1
fi

